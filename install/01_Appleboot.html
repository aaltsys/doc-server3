<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Configuring a Mac Mini Server &mdash; AAltsys Server 3.0 Installation 3.0 documentation</title>
    
    <link rel="stylesheet" href="_static/aaltsys.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="AAltsys Server 3.0 Installation 3.0 documentation" href="index.html" />
    <link rel="next" title="Make a Mac-Bootable USB" href="02_macserver.html" />
    <link rel="prev" title="Installing an Operating System" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="02_macserver.html" title="Make a Mac-Bootable USB"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="index.html" title="Installing an Operating System"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">AAltsys Server 3.0 Installation 3.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Configuring a Mac Mini Server</a><ul>
<li><a class="reference internal" href="#aaltsys-server-introduction">AAltsys Server Introduction</a></li>
<li><a class="reference internal" href="#mac-mini-configuration">Mac mini Configuration</a></li>
<li><a class="reference internal" href="#installing-google-chrome">Installing Google Chrome</a></li>
<li><a class="reference internal" href="#download-and-install-refind">Download and Install rEFInd</a><ul>
<li><a class="reference internal" href="#install-refind-software">Install rEFInd software</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reconfiguring-refind">Reconfiguring rEFInd</a><ul>
<li><a class="reference internal" href="#configure-refind">Configure rEFInd</a></li>
<li><a class="reference internal" href="#edit-refind-configuration">Edit rEFInd configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recovering-from-a-boot-coup">Recovering from a Boot Coup</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Installing an Operating System</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="02_macserver.html"
                        title="next chapter">Make a Mac-Bootable USB</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/01_Appleboot.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="configuring-a-mac-mini-server">
<span id="macserver"></span><h1>Configuring a Mac Mini Server<a class="headerlink" href="#configuring-a-mac-mini-server" title="Permalink to this headline">¶</a></h1>
<div class="section" id="aaltsys-server-introduction">
<h2>AAltsys Server Introduction<a class="headerlink" href="#aaltsys-server-introduction" title="Permalink to this headline">¶</a></h2>
<p>Desktop and tower computers are bulky, inefficient, and expensive. These
computers are undesirable for office servers, which is why we recommend the
Apple Mac mini, which is powerful, unobtrusive, and reliable.</p>
<p>We use Apple Mac mini hardware as a server running the Zentyal office server
operating system. (Zentyal is based on the popular Linux OS Ubuntu.) An added
SSD storage drive will be used for Zentyal server and data, and the original
Apple OS-X installation will be retained on the internal drive. A boot selector
program, rEFInd, will be used to permit operating system selection.</p>
</div>
<div class="section" id="mac-mini-configuration">
<h2>Mac mini Configuration<a class="headerlink" href="#mac-mini-configuration" title="Permalink to this headline">¶</a></h2>
<p>The components of the Mac mini, and the available accessories for it, change
over time. Older Mac minis include the Mac mini Server, now discontinued, which
offered two internal drives and a quad-core i7 hyper-threaded processor. Newer
Mac minis have dual-core i5 processors with hyper threading, providing a
maximum of four execution threads. This is adequate for an office server.</p>
<p>As of 10-15-2017, Apple&#8217;s Mac mini configuration <a class="footnote-reference" href="#id5" id="id1">[1]</a> used for this server is:</p>
<ul class="simple">
<li>2.6GHz Intel Dual-Core i5 (Turbo Boost up to 3.1GHz)</li>
<li>16GB 1600MHz LPDDR3 SDRAM</li>
<li>1TB Serial ATA Drive &#64; 5400 rpm</li>
</ul>
<p>The following additional components convert the Mac mini to a server:</p>
<ul class="simple">
<li>Samsung T5 256 GB SSD drive w/ USB 3.1 to 3.0 cable (for server storage),</li>
<li>Thunderbolt to Gigabit Ethernet adapter (for Internet gateway function),</li>
<li>Zentyal - windows-compatible office server operating system replaces OS-X,</li>
<li>rEFInd - multi-boot program for EFI and UEFI systems, particularly Macs,</li>
<li>Chrome - Google&#8217;s browser is installed in OS-X as part of initial setup.</li>
</ul>
<p>Additional generic hardware components will be used during system configuration
or are required for site setup and administration:</p>
<ul class="simple">
<li>Superdrive - or any USB-connected CD-ROM drive (during installation only),</li>
<li>USB Keyboard and mouse, HDMI-connected 1080p monitor (for administration),</li>
</ul>
</div>
<div class="section" id="installing-google-chrome">
<h2>Installing Google Chrome<a class="headerlink" href="#installing-google-chrome" title="Permalink to this headline">¶</a></h2>
<p>Follow these step by step instructions to install Google Chrome on OS-X:</p>
<ol class="arabic simple">
<li>Launch the Safari browser fror the Activity task bar</li>
<li><a class="reference external" href="https://www.google.com/chrome/browser">Download the Chrome installer</a></li>
<li>Launch file <code class="file docutils literal"><span class="pre">Google</span> <span class="pre">Chrome.dmg</span></code> from the downloads</li>
<li>In the window that opens, drag the Chrome icon into the Application folder</li>
<li>When first opening Chrome, the Finder will ask if you want to open the
Application downloaded from the Internet. Click open.</li>
<li>Unmount the Google Chrome disk image on your Desktop by right clicking it and
choosing &#8220;Eject&#8221;.</li>
</ol>
</div>
<div class="section" id="download-and-install-refind">
<span id="refind"></span><h2>Download and Install rEFInd<a class="headerlink" href="#download-and-install-refind" title="Permalink to this headline">¶</a></h2>
<p>Apple replaced BIOS booting with EFI (Extensible Firmware Interface), allowing
software to control the computer boot process. Apple offers <strong class="program">BootCamp</strong>
software to boot Windows on Macs, but this only works with Windows.</p>
<p><strong>Roderick Smith</strong> has written an excellent boot manager supporting multiple
hardware platforms and various operating systems, particularly <strong class="program">Linux</strong>
and Macintosh <strong class="program">OS-X</strong>. Further, he maintains a reference book on EFI
booting using his <a class="reference external" href="http://www.rodsbooks.com/refind/">rEFInd program</a>.</p>
<div class="section" id="install-refind-software">
<h3>Install rEFInd software<a class="headerlink" href="#install-refind-software" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first"><a class="reference external" href="http://www.rodsbooks.com/refind/getting.html">Download rEFInd software</a>
to your <code class="file docutils literal"><span class="pre">Downloads</span></code> folder. <a class="footnote-reference" href="#id6" id="id2">[2]</a></p>
</li>
<li><p class="first">On later Macs with <strong>SIP</strong>, press <code class="kbd docutils literal"><span class="pre">alt/option</span></code> to reboot to the
<code class="file docutils literal"><span class="pre">Recovery</span> <span class="pre">HD</span></code> volume and then disable <strong>SIP</strong> with the command:</p>
<div class="highlight-python"><div class="highlight"><pre>csrutil disable
</pre></div>
</div>
<p>Then reboot to the Mac OS-X system on volume <code class="file docutils literal"><span class="pre">Macintosh</span> <span class="pre">HD</span></code>.
(As an alternative, use Rod&#8217;s guide to install <strong class="program">rEFInd</strong> from the
Recovery boot <a class="footnote-reference" href="#id7" id="id3">[3]</a> in place of this step and the next step.)</p>
</li>
<li><p class="first">Open a terminal session, change directory to the <code class="file docutils literal"><span class="pre">Downloads</span></code> folder,
and unzip and install <strong class="program">Refind</strong> with the commands:</p>
<div class="highlight-python"><div class="highlight"><pre>cd ~/Downloads
unzip refind &lt;Tab&gt; &lt;Enter&gt;
cd refind &lt;Tab&gt; &lt;Enter&gt;
./refind.install
</pre></div>
</div>
</li>
<li><p class="first">Read the installation messages to see where <strong class="program">REFInd</strong> is installed.
For message <code class="docutils literal"><span class="pre">Installing</span> <span class="pre">rEFInd</span> <span class="pre">to</span> <span class="pre">the</span> <span class="pre">partition</span> <span class="pre">mounted</span> <span class="pre">at</span> <span class="pre">/Volumes/ESP</span></code>,
bless <strong class="program">REFInd</strong> with the command:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo bless --mount /Volumes/ESP --setBoot --file /Volumes/ESP/efi/refind/refind_x64.efi --shortform
</pre></div>
</div>
<p>Otherwise for <strong class="program">REFInd</strong> installed in folder <code class="file docutils literal"><span class="pre">EFI</span></code>, use:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo bless --setBoot --folder /efi/refind --file /efi/refind/refind_x64.efi
</pre></div>
</div>
</li>
<li><p class="first">After installing <strong class="program">rEFInd</strong>, copy or rename the default configuration
file <code class="file docutils literal"><span class="pre">refind.conf</span></code> to preserve it. This file should be in one of the
following locations:</p>
<div class="highlight-python"><div class="highlight"><pre>/Volumes/ESP/efi/refind/
/efi/refind/
</pre></div>
</div>
</li>
<li><p class="first">To boot Zentyal by default, download the customized refind configuration
<a class="reference download internal" href="_downloads/refind.conf"><code class="xref download docutils literal"><span class="pre">refind.conf</span></code></a> to folder <code class="file docutils literal"><span class="pre">refind</span></code>.</p>
</li>
<li><p class="first">For Macs with SIP, reboot and press a cursor key to stop <strong class="program">rEFInd</strong>.
Use the mouse or cursor keys to select small icons items:</p>
<p><em>i</em> &#8211; the info icon will say whether SIP is off or on
<em>shield</em> &#8211; toggles the SIP state off and on
<em>circle-arrows</em> &#8211; reboot the system after any changes</p>
</li>
</ol>
</div>
</div>
<div class="section" id="reconfiguring-refind">
<h2>Reconfiguring rEFInd<a class="headerlink" href="#reconfiguring-refind" title="Permalink to this headline">¶</a></h2>
<p>The <strong class="program">rEFInd</strong> configuration which defaults to booting Linux, as used in
this guide, is shown below:</p>
<p>timeout 5
enable_mouse
use_graphics_for osx, linux
# skip recovery and backup drives; ubuntu options; shimx64.efi and mmx64.efi
dont_scan_volumes &#8220;Recovery HD&#8221;,&#8221;Backup&#8221;
dont_scan_dirs EFI/ubuntu
dont_scan_files shim.efi,MokManager.efi,mmx64.efi
# report linux installations, one kernel per install
scan_all_linux_kernels
fold_linux_kernels
# show first 3 options as primary choices, default to Zentyal,or Mac OS-X
max_tags 3
default_selection &#8220;vmlinuz,macOS&#8221;
# Allow refind to disable/enable SIP so boot reconfiguration is possible
showtools shell,memtest,gdisk,apple_recovery,about,csr_rotate,shutdown,reboot
csr_values 10,77</p>
<p>Use the instructions in this section if you wish to change boot configuration
options.</p>
<div class="section" id="configure-refind">
<h3>Configure rEFInd<a class="headerlink" href="#configure-refind" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>After installing <strong class="program">rEFInd</strong>, copy or rename the default
<code class="file docutils literal"><span class="pre">refind.conf</span></code> configuration file to preserve it.</li>
<li>Restart the server, and press <code class="kbd docutils literal"><span class="pre">right-arrow</span></code> in <strong class="program">rEFInd</strong> to
stop booting.</li>
<li>Write down each main boot option to decide which should be displayed.</li>
<li>Determine any other configuration options to change. <a class="footnote-reference" href="#id8" id="id4">[4]</a></li>
</ol>
</div>
<div class="section" id="edit-refind-configuration">
<h3>Edit rEFInd configuration<a class="headerlink" href="#edit-refind-configuration" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Start a terminal from <em class="menuselection">Launchpad ‣ Other ‣ Terminal</em>.</p>
</li>
<li><p class="first">Edit the <strong class="program">rEFInd</strong> configuration file with the command:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo nano /Volumes/ESP/efi/refind/refind.conf
</pre></div>
</div>
<p>or for older Macs with an <code class="file docutils literal"><span class="pre">EFI</span></code> folder and no <code class="file docutils literal"><span class="pre">ESP</span></code> volume,</p>
<div class="highlight-python"><div class="highlight"><pre>sudo nano /efi/refind/refind.conf
</pre></div>
</div>
<p>and enter your password when prompted.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Mac approach of displaying files in the Finder and then editing
configuration text in <strong class="program">TextEdit</strong> will not to work with boot
manager files. This section uses a Linux-y approach to editing the <strong class="program">rEFInd</strong> configuration instead.</p>
</div>
</li>
<li><p class="first">Modify the configuration options as desired, then press <code class="kbd docutils literal"><span class="pre">control-X</span></code> to
save changes.</p>
</li>
<li><p class="first">Exit all programs and restart the server to test the new configuration.</p>
</li>
</ol>
<p>Repeat these instructions until desired results are achieved.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Save a copy of the modified <code class="file docutils literal"><span class="pre">refind.conf</span></code> in your <code class="file docutils literal"><span class="pre">~/Documents</span></code>
folder, as updates to Mac OS X might wipe out the EFI configuration.</p>
</div>
<p>After achieving a good <strong class="program">rEFInd</strong> configuration, turn SIP back on with
either:</p>
<ul class="simple">
<li>Rebooting from a <strong class="program">rEFInd</strong> CD and selecting <strong class="command">SIP Policy</strong>
from the tools,</li>
<li>Rebooting from the Apple Recovery partition and executing the command
<strong class="command">csrutil enable</strong>,</li>
<li>Rebooting and selecting <strong class="command">SIP Policy</strong> from the <strong class="program">rEFInd</strong>
tools, provided you have enabled tool <strong class="program">csr_rotate</strong>.</li>
</ul>
</div>
</div>
<div class="section" id="recovering-from-a-boot-coup">
<h2>Recovering from a Boot Coup<a class="headerlink" href="#recovering-from-a-boot-coup" title="Permalink to this headline">¶</a></h2>
<p>The <code class="file docutils literal"><span class="pre">efi</span></code> directory may get rewritten when updating either Mac OS-X or
Linux. Keep program <strong class="program">rEFInd</strong> in your <code class="file docutils literal"><span class="pre">~/Downloads</span></code> folder, and
keep a copy of <code class="file docutils literal"><span class="pre">refind.conf</span></code> in your <code class="file docutils literal"><span class="pre">~/Documents</span></code> folder. Restore
a lost <strong class="program">rEFInd</strong> installation in Mac OS X as follows:</p>
<ol class="arabic">
<li><p class="first">Start a terminal from <em class="menuselection">Launchpad ‣ Other ‣ Terminal</em></p>
</li>
<li><p class="first">Reinstall <strong class="program">rEFInd</strong> with the commands:</p>
<div class="highlight-python"><div class="highlight"><pre>cd ~/Downloads/refind &lt;Tab&gt; &lt;Enter&gt;
./install.refind
sudo cp ~/Documents/refind.conf /efi/refind/
</pre></div>
</div>
<p>&#8211; or &#8211;</p>
<div class="highlight-python"><div class="highlight"><pre>sudo cp ~/Documents/refind.conf Volumes/ESP/efi/refind/
</pre></div>
</div>
</li>
</ol>
<hr class="docutils" />
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://www.apple.com/mac-mini/specs/">Mac mini specifications</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="http://www.rodsbooks.com/refind/getting.html">How to obtain rEFInd</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><a class="reference external" href="http://www.rodsbooks.com/refind/sip.html#recovery">Install rEFInd</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><a class="reference external" href="http://www.rodsbooks.com/refind/configfile.html">Configuring rEFInd</a>.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="02_macserver.html" title="Make a Mac-Bootable USB"
             >next</a></li>
        <li class="right" >
          <a href="index.html" title="Installing an Operating System"
             >previous</a> |</li>
        <li><a href="index.html">AAltsys Server 3.0 Installation 3.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2012, Gerald Lovel.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b1.
    </div>
  </body>
</html>