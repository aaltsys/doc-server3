----------

Download and Install rEFInd 
=============================

**Roderick Smith** has written an excellent boot manager supporting multiple 
hardware platforms and various operating systems, particularly :program:`Linux` 
and Macintosh :program:`OS-X`. Further, he maintains an extensive on-line 
`book <http://www.rodsbooks.com/refind/>`_ on the subject of boot loaders. 
These brief instructions are based on Rod's book, which is the actual 
authoritative documentation of this subject.

Install rEFInd software
-----------------------------

#. From `Rod's Books website <http://www.rodsbooks.com/refind/getting.html>`_,
   download the latest version of :program:`REFInd` to your :file:`Downloads` 
   folder.
#. On later Macs with **SIP** [#]_, press :kbd:`alt/option` to reboot to the 
   :file:`Recovery HD` volume and then disable **SIP** with the command::

      csrutil disable

   Then reboot to the Mac OS-X system on volume :file:`Macintosh HD`.
#. Open a terminal session, change directory to the :file:`Downloads` folder,
   and unzip and install :program:`Refind` with the commands::

      cd ~/Downloads
      unzip refind <Tab> <Enter>
      cd refind <Tab> <Enter>
      ./refind.install

#. Read the installation messages to see where :program:`REFInd` is installed. 
   For message ``Installing rEFInd to the partition mounted at /Volumes/ESP``,
   bless :program:`REFInd` with the command::

      sudo bless --mount /Volumes/ESP --setBoot --file /Volumes/ESP/efi/refind/refind_x64.efi --shortform

   Otherwise for :program:`REFInd` installed in folder :file:`\EFI`, use::

      sudo bless --setBoot --folder /efi/refind --file /efi/refind/refind_x64.efi

Configure rEFInd
-----------------------------

#. After installing :program:`rEFInd`, copy or rename the default 
   :file:`refind.conf` configuration file to preserve it. 
#. Restart the server, and press :kbd:`right-arrow` in :program:`rEFInd` to 
   stop booting.
#. Write down each main boot option to decide which should be displayed.
#. Determine any other configuration options to change. [#]_

Edit rEFInd configuration
-----------------------------

#. Start a terminal from :menuselection:`Launchpad --> Other --> Terminal`.
#. Edit the :program:`rEFInd` configuration file with the command::

      sudo nano /Volumes/ESP/efi/refind/refind.conf

   or for older Macs with an :file:`EFI` folder and no :file:`ESP` volume, ::

      sudo nano /efi/refind/refind.conf

   and enter your password when prompted.

   .. note::
      The Mac approach of displaying files in the Finder and then editing 
      configuration text in :program:`TextEdit` will not to work with boot 
      manager files. This section uses a Linux-y approach to editing the :program:`rEFInd` configuration instead.

#. Modify the configuration options as desired, then press :kbd:`control-X` to
   save changes.
#. Exit all programs and restart the server to test the new configuration.

Repeat these instructions until desired results are achieved. 

.. tip:: 
   Save a copy of the modified :file:`refind.conf` in your :file:`~/Documents`
   folder, as updates to Mac OS X might wipe out the EFI configuration.

After achieving a good :program:`rEFInd` configuration, turn SIP back on with 
either:

*  Rebooting from a :program:`rEFInd` CD and selecting :command:`SIP Policy` 
   from the tools, 
*  Rebooting from the Apple Recovery partition and executing the command
   :command:`csrutil enable`, 
*  Rebooting and selecting :command:`SIP Policy` from the :program:`rEFInd` 
   tools, provided you have enabled tool :program:`csr_rotate`. 

Example Refind Configuration
-----------------------------

A sample :program:`rEFInd` configuration file for a dual-boot Linux/Macintosh system which defaults to booting Linux is shown below:

.. include:: ./downloads/refind.conf

Download :download:`refind.conf <./_downloads/refind.conf>` to directory 
:file:`refind`, overwriting the default configuration, to install this set of 
options.

Recovering from a Boot Coup
=============================
 
The :file:`efi` directory is cleared and rewritten when updating Mac OS-X. Keep 
program :program:`rEFInd` in your :file:`~/Downloads` folder, and keep a copy 
of :file:`refind.conf` in your :file:`~/Documents` folder. Restore a lost
:program:`rEFInd` installation in Mac OS X as follows:

#. Start a terminal from :menuselection:`Launchpad --> Other --> Terminal`
#. Reinstall :program:`rEFInd` with the commands::

      cd ~/Downloads/refind <Tab> <Enter>
      ./install.refind
      sudo cp ~/Documents/refind.conf /efi/refind/ 
 
