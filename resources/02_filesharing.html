<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Mounting Network File Systems &mdash; AAltsys Server 3.0 Technical 3.0 documentation</title>
    
    <link rel="stylesheet" href="_static/aaltsys.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="AAltsys Server 3.0 Technical 3.0 documentation" href="index.html" />
    <link rel="next" title="Remote Secure Shell Sessions" href="03_secureshell.html" />
    <link rel="prev" title="Printing With Zentyal" href="01_printing.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="03_secureshell.html" title="Remote Secure Shell Sessions"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="01_printing.html" title="Printing With Zentyal"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">AAltsys Server 3.0 Technical 3.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Mounting Network File Systems</a><ul>
<li><a class="reference internal" href="#using-sshfs-file-shares-in-linux">Using sshfs File Shares in Linux</a><ul>
<li><a class="reference internal" href="#part-1-configure-file-systems">Part 1: Configure File Systems</a></li>
<li><a class="reference internal" href="#part-2-setup-server-access">Part 2. Setup Server Access</a></li>
<li><a class="reference internal" href="#part-3-provide-your-ssh-key">Part 3. Provide your ssh key</a></li>
<li><a class="reference internal" href="#when-this-does-not-work">When this does not work</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mounting-file-shares-in-windows">Mounting File Shares in Windows</a></li>
<li><a class="reference internal" href="#server-sshfs-configuration">Server SSHFS Configuration</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="01_printing.html"
                        title="previous chapter">Printing With Zentyal</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="03_secureshell.html"
                        title="next chapter">Remote Secure Shell Sessions</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/02_filesharing.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="mounting-network-file-systems">
<h1>Mounting Network File Systems<a class="headerlink" href="#mounting-network-file-systems" title="Permalink to this headline">¶</a></h1>
<div class="section" id="using-sshfs-file-shares-in-linux">
<h2>Using sshfs File Shares in Linux<a class="headerlink" href="#using-sshfs-file-shares-in-linux" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This guide describes connecting to either local or remote server file
systems from Linux or Unix desktops. The specific commands in this guide
are given for Ubuntu; syntax will differ with other systems.</p>
</div>
<div class="section" id="part-1-configure-file-systems">
<h3>Part 1: Configure File Systems<a class="headerlink" href="#part-1-configure-file-systems" title="Permalink to this headline">¶</a></h3>
<p>This section must be performed once on each local desktop to prepare the system
to connect. First configure the desktop to use remote filesystems by installing
packages and loading the kernel module <strong>fuse</strong>. (The fuse file system is not
included in default system configurations.) For Debian/Ubuntu users, use your
preferred editor to create a script file on the Desktop as follows (cut and
paste the text):</p>
<div class="highlight-python"><pre>#!/usr/bin/env bash
apt-get --no-upgrade install sshfs fuse-utils autofs
modprobe --first-time fuse
if [ $? -eq 0 ]
then echo "fuse" &gt;&gt; /etc/modules
fi</pre>
</div>
<p>Save the bash script on the Desktop as <strong>fuse.sh</strong>. Open a terminal session on
the desktop, set the permissions for the file to executable, and execute the
script:</p>
<div class="highlight-python"><pre>chmod +x fuse.sh
sudo ./fuse.sh</pre>
</div>
</div>
<div class="section" id="part-2-setup-server-access">
<h3>Part 2. Setup Server Access<a class="headerlink" href="#part-2-setup-server-access" title="Permalink to this headline">¶</a></h3>
<p>This section is performed once for each remote server, to add information about
the server to the local desktop. Instructions are provided using Domain Names.
IP addresses would also work, but then the shares would not be accessible both
locally and remotely. When DNS is properly configured, access works whether the
connection is local, bridged, VPN, or public.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Throughout these instructions, replace <strong>HOSTSERVER</strong>, <strong>DOMAIN</strong>, and
<strong>TLD</strong> with the name of the server to be accessed, the domain for the
server, and the top-level domain (.com, .net, etc.). For example,
<strong>HOSTSERVER.DOMAIN.TLD</strong> might be replaced with <em>officeserver.aaltsys.com</em>
for the office server at AAltSys.</p>
</div>
<div class="sidebar">
<p class="first sidebar-title">/etc/auto.master</p>
<p>Each entry in <strong>auto.master</strong> defines a file access point which binds to a
remote server. For example, file requests to <strong>/mnt/HOSTSERVER</strong> will
automount  <strong>HOSTSERVER</strong> shares. Shares will be unmounted if idle for over
30 seconds.</p>
<p><strong>/etc/auto.HOSTSERVER</strong></p>
<p class="last">A list of share mappings is required for each remote server. Here
<strong>HOSTSERVER</strong> has two shares, <strong>PUBLIC</strong> and <strong>*</strong>. Entries start with a
name (e.g., <tt class="docutils literal"><span class="pre">public</span></tt>), followed by configuration parameters:
<tt class="docutils literal"><span class="pre">-fstype=fuse,rw,...</span></tt>, and user ssh credentials:
<tt class="docutils literal"><span class="pre">IdentityFile=$HOME/.ssh/id_rsa</span></tt>. Last is the URI for accessing the share:
<tt class="docutils literal"><span class="pre">:sshfs\#$USER&#64;HOSTSERVER.DOMAIN.TLD\:/.../public</span></tt>.</p>
</div>
<p>Assign a mount point (a file directory pointer) for the remote server to use:</p>
<div class="highlight-python"><pre>sudo mkdir /mnt/HOSTSERVER/</pre>
</div>
<p>The master configuration file, <strong>auto.master</strong>, provides <strong>autofs</strong> with mount
names and server configurations for shares. At the terminal, type the command:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sudoedit</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">auto</span><span class="o">.</span><span class="n">master</span>
</pre></div>
</div>
<p>and add the following line of text, replacing HOSTSERVER with the server name:</p>
<div class="highlight-python"><pre>/mnt/HOSTSERVER /etc/auto.HOSTSERVER --timeout=30,--ghost</pre>
</div>
<p>Now create and edit the server configuration file, <strong>auto.HOSTSERVER</strong>, to
provide server-specific information:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sudoedit</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">auto</span><span class="o">.</span><span class="n">HOSTSERVER</span>
</pre></div>
</div>
<p>and enter and save the share configuration information, such as:</p>
<div class="highlight-python"><pre>public -fstype=fuse,rw,nodev,nonempty,noatime,max_read=65536,allow_other,compression=yes,uid=$UID,gid=$GID,StrictHostKeyChecking=no,IdentityFile=$HOME/.ssh/id_rsa,umask=0007 :sshfs\#$USER@HOSTSERVER.DOMAIN.TLD\:/home/samba/shares/public/
* -fstype=fuse,rw,allow_other,nodev,nonempty,noatime,max_read=65536,compression=yes,uid=$UID,gid=$GID,StrictHostKeyChecking=no,IdentityFile=$HOME/.ssh/id_rsa,umask=0077 :sshfs\#$USER@HOSTSERVER.DOMAIN.TLD\:/home/&amp;</pre>
</div>
<p>Restart the autofs module to load the changed configuration:</p>
<div class="highlight-python"><pre>sudo /etc/init.d/autofs restart
sudo ssh HOSTSERVER.DOMAIN.TLD</pre>
</div>
<p>When prompted for the root password of the remote host, press <tt class="kbd docutils literal"><span class="pre">&lt;Ctrl-C&gt;</span></tt>
to exit the command.</p>
</div>
<div class="section" id="part-3-provide-your-ssh-key">
<h3>Part 3. Provide your ssh key<a class="headerlink" href="#part-3-provide-your-ssh-key" title="Permalink to this headline">¶</a></h3>
<p>This section must be performed for each local user who will access the remote
server. Type the following commands to (1) create an ssh private key provided
one does not exist, and (2) copy a user public key to the remote server for
authentication:</p>
<div class="highlight-python"><pre>if [ ! -f "$HOME/.ssh/id_rsa" ]; then ssh-keygen; fi
ssh-copy-id `id -un`@HOSTSERVER.DOMAIN.TLD</pre>
</div>
<p>Now verify that the remote folders will mount:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ls</span> <span class="o">-</span><span class="n">al</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">HOSTSERVER</span>
<span class="n">ls</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">HOSTSERVER</span><span class="o">/</span><span class="sb">`id -un`</span>
</pre></div>
</div>
<p>Bookmark folders in /mnt/HOSTSERVER in the file manager for easy access.</p>
</div>
<div class="section" id="when-this-does-not-work">
<h3>When this does not work<a class="headerlink" href="#when-this-does-not-work" title="Permalink to this headline">¶</a></h3>
<p>If the public folder or user home folder will not mount, try the following:</p>
<div class="highlight-python"><pre>ssh `id -un`@HOSTSERVER.DOMAIN.TLD
chmod og-w ~
chmod og-w ~/.ssh
chmod 600 ~/.ssh/authorized_keys</pre>
</div>
</div>
</div>
<div class="section" id="mounting-file-shares-in-windows">
<h2>Mounting File Shares in Windows<a class="headerlink" href="#mounting-file-shares-in-windows" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Local file sharing to Windows desktops is handled through Microsoft CIFS
services, also known as SAMBA in the Linux community. Due to inherent
security limitations, SAMBA shares should not be accessed remotely. The
secure shell service (ssh) which provides local and remote access with
Linux is not supported by Windows. Remote file sharing for Windows desktops
generally requires using a VPN instead.</p>
</div>
</div>
<div class="section" id="server-sshfs-configuration">
<h2>Server SSHFS Configuration<a class="headerlink" href="#server-sshfs-configuration" title="Permalink to this headline">¶</a></h2>
<p>Install authentication and sharing modules on the server as follows:</p>
<div class="highlight-python"><pre>sudo aptitude install openssh-server libpam-modules</pre>
</div>
<p>The default server umask=0022 will shade permissions for files and folders
created on the server. Private home folders with umask=0077 will work just
fine, but public folders needing umask=0007 will result in incorrect
permissions which block write access. To prevent this problem:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sudoedit</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">pam</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">sshd</span>
</pre></div>
</div>
<p>Now add the following three lines:</p>
<div class="highlight-python"><pre># Default umask mask for SSH/SFTP sessions
# Shell sessions: Override with /etc/profile or ~/.bashrc or ~/.profile
session optional        pam_umask.so umask=0000</pre>
</div>
<p>As noted above, actual ssh shell logins on the server will get the default
<tt class="docutils literal"><span class="pre">umask=022</span></tt> on new files and directories. The following command will change
this for all shell logins:</p>
<div class="highlight-python"><pre>sudo sed -i s/umask 022/umask 0007/ /etc/profile</pre>
</div>
<p>A logged in user could change just their own default umask with the command:</p>
<div class="highlight-python"><pre>sudo sed -i s/#umask\ 022/umask\ 0007/ ~/.profile</pre>
</div>
<p>References:</p>
<p><a class="reference external" href="http://wiki.lapipaplena.org/index.php/How_to_mount_SFTP_accesses">How to mount SFTP accesses.</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="03_secureshell.html" title="Remote Secure Shell Sessions"
             >next</a></li>
        <li class="right" >
          <a href="01_printing.html" title="Printing With Zentyal"
             >previous</a> |</li>
        <li><a href="index.html">AAltsys Server 3.0 Technical 3.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Gerald Lovel.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b3.
    </div>
  </body>
</html>